# Workflow Standards

**Source of Truth**: Both (this file for detailed standards, CLAUDE.md for overview)
**Last Updated**: 2026-01-16

## Context Management

**Goal**: Minimize main context consumption while maximizing quality.

### Delegation Principle

Offload work that would consume significant main context:
- Multi-file exploration or search
- Repetitive verification tasks
- Information gathering before decisions
- Independent parallel workstreams

Choose the most context-efficient approach autonomously. Trust your judgment on tool/agent selection.

### Parallel Execution

When tasks are independent, execute them in parallel. Don't serialize unnecessarily.

## Commit Practices

### Conventional Commits

Follow conventional commit format:

- `feat(plugin):` New features
- `fix(plugin):` Bug fixes
- `docs(plugin):` Documentation updates
- `refactor(plugin):` Code refactoring

### Commit Discipline

- Separate commits: structural changes vs behavioral changes
- One logical change per commit
- Descriptive commit messages (why, not just what)

## Version Management

### Semantic Versioning

- **Major** (1.0.0): Breaking changes
- **Minor** (0.1.0): New features, backward compatible
- **Patch** (0.0.1): Bug fixes

### Version Bump Rules

| Change Type       | Version Bump   | Examples                            |
| ----------------- | -------------- | ----------------------------------- |
| Bug fix, typo fix | Patch (0.0.x)  | Script error fix, docs typo         |
| New command/agent | Minor (0.x.0)  | Add new agent, new command          |
| Breaking change   | Major (x.0.0)  | Change state format, remove command |
| Behavior change   | Minor or Major | Depends on backward compatibility   |

### Version Sync Protocol

**CRITICAL**: When updating versions, MUST sync both files:
1. Update `plugins/{plugin}/.claude-plugin/plugin.json` (plugin version)
2. Update `.claude-plugin/marketplace.json` (marketplace version)

```bash
# Verify version sync
diff <(jq -r '.version' plugins/ultrawork/.claude-plugin/plugin.json) \
     <(jq -r '.plugins[] | select(.name=="ultrawork") | .version' .claude-plugin/marketplace.json)
```

## Self-Correction Protocol

### Warning Signals

Stop and reassess if:
- Loops/retries increasing without progress
- Adding unrequested features
- Temptation to disable/delete tests
- Same error appearing 3+ times

### Recovery Action

**"Going in circles" = stop, explain blocker, ask for guidance.**

Never continue if:
- Same approach failing repeatedly
- Unclear requirements blocking progress
- Missing dependencies preventing completion

## Quality Skills

Invoke when relevant:
- `systematic-debugging`: Root cause analysis
- `code-completeness-verification`: Thorough review
- `documentation-verification`: Accuracy check

## Code Review Checklist

- [ ] `set -euo pipefail` in all scripts
- [ ] Flag-based parameter parsing
- [ ] Error handling with meaningful messages
- [ ] No hardcoded paths (use environment variables)
- [ ] JSON validation before writes
- [ ] CLAUDE.md updated with changes
- [ ] Version synced: `plugin.json` == `marketplace.json`
